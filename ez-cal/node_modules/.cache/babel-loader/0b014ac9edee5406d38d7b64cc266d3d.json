{"ast":null,"code":"import _slicedToArray from \"/Users/boyuwang/Documents/GitHub/travis/ez-cal/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/boyuwang/Documents/GitHub/travis/ez-cal/src/ApiCalendar.js\";\nimport { db } from './firebase';\nimport { subTimes, times } from './constants';\nimport React, { Component } from 'react';\nimport LinkGenerator from \"./LinkGenerator\";\nimport { Switch, Route } from 'react-router-dom';\nimport Addevents from \"./newaddevent\";\n\nconst Config = require(\"./data/apiGoogleconfig.json\");\n\nexport default class ApiCalendar extends Component {\n  constructor(props) {\n    super(props);\n\n    this.componentDidMount = () => {\n      const userLink = window.location.pathname.substring(1);\n\n      if (userLink) {\n        db.child(userLink).child(\"userName\").once('value', this.printUserName, error => alert(error));\n        db.child(userLink).child(\"calID\").once('value', this.setOtherID, error => alert(error));\n        db.child(userLink).child(\"events\").once('value', this.handleData, error => alert(error));\n      }\n    };\n\n    this.printUserName = snap => {\n      if (snap.val()) {\n        this.setState({\n          otherUser: snap.val()\n        });\n      }\n    };\n\n    this.setOtherID = snap => {\n      if (snap.val()) {\n        this.setState({\n          otherCalID: snap.val()\n        });\n      }\n    };\n\n    this.handleData = snap => {\n      if (snap.val()) {\n        if (this.state.otherUser) {\n          this.setBusy2(Object.values(snap.val(), this.state.otherUser));\n        }\n      }\n    };\n\n    this.checkLastDay = (month, year) => {\n      var numberOfDays;\n      if (month == 4 || month == 6 || month == 9 || month == 11) numberOfDays = 30;else if (month == 2) {\n        const isLeapYear = year => year % 4 == 0 && year % 100 != 0 || year % 400 == 0;\n\n        if (isLeapYear(year)) numberOfDays = 29;else numberOfDays = 28;\n      } else numberOfDays = 31;\n      return numberOfDays;\n    };\n\n    this.buildDayList = () => {\n      let date = new Date();\n      let numberOfDays = this.checkLastDay(date.getMonth() + 1, date.getFullYear());\n      let weekDays = [\"Su\", \"M\", \"Tu\", \"W\", \"Th\", \"F\", \"Sa\"];\n      let dayList = [],\n          dateList = [];\n\n      for (let i = 0; i < 7; i++) {\n        dayList.push(weekDays[(date.getDay() + i) % 7]);\n\n        if (date.getDate() + i > numberOfDays) {\n          dateList.push((date.getDate() + i) % numberOfDays);\n        } else {\n          dateList.push(date.getDate() + i);\n        }\n      }\n\n      return [dayList, dateList];\n    };\n\n    this.dayGrid = () => {\n      let _this$buildDayList = this.buildDayList(),\n          _this$buildDayList2 = _slicedToArray(_this$buildDayList, 2),\n          days = _this$buildDayList2[0],\n          dates = _this$buildDayList2[1];\n\n      let realTimes = subTimes.slice(0, subTimes.length - 1);\n      let timeBlock = realTimes.map(x => {\n        return x.split(\":\")[1] === \"00\" ? React.createElement(\"div\", {\n          className: \"dayTime\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 118\n          },\n          __self: this\n        }, x) : React.createElement(\"div\", {\n          className: \"dayTime\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 118\n          },\n          __self: this\n        });\n      });\n      let cal = [];\n      cal.push(React.createElement(\"div\", {\n        className: \"dayCol\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"dayEmpty\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 123\n        },\n        __self: this\n      }), timeBlock));\n\n      for (let i = 0; i < days.length; i++) {\n        let hours = [];\n\n        for (let j = 0; j < subTimes.length; j++) {\n          if (subTimes[j] === \"0:00\") {\n            hours.push(React.createElement(\"div\", {\n              id: \"\".concat(dates[i], \" \").concat(subTimes[j]),\n              styles: {\n                display: \"hidden\"\n              },\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 132\n              },\n              __self: this\n            }));\n          } else if (times.includes(subTimes[j])) {\n            hours.push(React.createElement(\"div\", {\n              id: \"\".concat(dates[i], \" \").concat(subTimes[j]),\n              className: \"dayHour\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 135\n              },\n              __self: this\n            }));\n          } else {\n            hours.push(React.createElement(\"div\", {\n              id: \"\".concat(dates[i], \" \").concat(subTimes[j]),\n              className: \"daySubHour\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 138\n              },\n              __self: this\n            }));\n          }\n        }\n\n        cal.push(React.createElement(\"div\", {\n          className: \"dayCol\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 142\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"dayHead\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 143\n          },\n          __self: this\n        }, days[i], React.createElement(\"div\", {\n          className: \"dayDate\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 144\n          },\n          __self: this\n        }, dates[i])), hours));\n      }\n\n      return React.createElement(\"div\", {\n        className: \"dayWrapper\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152\n        },\n        __self: this\n      }, cal);\n    };\n\n    this.SharedCalendar = () => {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      }, this.dayGrid());\n    };\n\n    this.MyCalendar = () => {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168\n        },\n        __self: this\n      }, this.dayGrid());\n    };\n\n    this.Main = () => {\n      return React.createElement(Switch, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176\n        },\n        __self: this\n      }, React.createElement(Route, {\n        exact: true,\n        path: \"/\",\n        component: this.MyCalendar,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }), React.createElement(Route, {\n        path: window.location.pathname,\n        component: this.SharedCalendar,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178\n        },\n        __self: this\n      }));\n    };\n\n    this.setLink = uid => {\n      return window.location.href + uid;\n    };\n\n    this.showEvents = () => {\n      let googleEvents;\n      if (this.sign) this.listUpcomingEvents().then(({\n        result\n      }) => {\n        googleEvents = result.items;\n        this.setState({\n          uid: this.getUserID(),\n          userName: this.getUserName()\n        });\n        db.child(this.getUserID()).child('events').set(googleEvents);\n        db.child(this.getUserID()).child('userName').set(this.getUserName());\n        db.child(this.getUserID()).child('calID').set(this.getEmail());\n        this.setBusy(googleEvents);\n      });\n    };\n\n    this.setBusy = events => {\n      const userLink = window.location.pathname.substring(1);\n\n      if (!userLink) {\n        for (let i = 0; i < events.length; i++) {\n          if (!events[i].start.dateTime) {\n            continue;\n          }\n\n          let date = events[i].start.dateTime.substring(8, 10);\n\n          if (date.substring(0, 1) === '0') {\n            date = date.substring(1);\n          }\n\n          let start = events[i].start.dateTime.substring(11, 16);\n          let end = events[i].end.dateTime.substring(11, 16);\n\n          if (start.substring(0, 1) === '0') {\n            start = start.substring(1);\n          }\n\n          if (end.substring(0, 1) === '0') {\n            end = end.substring(1);\n          }\n\n          let startIndex = subTimes.indexOf(start);\n          let endIndex = subTimes.indexOf(end);\n\n          for (let j = startIndex; j < endIndex; j++) {\n            let nextEvent = document.getElementById(\"\".concat(date, \" \").concat(subTimes[j]));\n\n            if (nextEvent.className.includes(\"Busy\")) {\n              continue;\n            } else {\n              nextEvent.className += \"Busy\";\n            }\n          }\n        }\n      } else if (userLink && this.state.uid) {\n        for (let i = 0; i < events.length; i++) {\n          if (!events[i].start.dateTime) {\n            continue;\n          }\n\n          let date = events[i].start.dateTime.substring(8, 10);\n\n          if (date.substring(0, 1) === '0') {\n            date = date.substring(1);\n          }\n\n          let start = events[i].start.dateTime.substring(11, 16);\n          let end = events[i].end.dateTime.substring(11, 16);\n\n          if (start.substring(0, 1) === '0') {\n            start = start.substring(1);\n          }\n\n          if (end.substring(0, 1) === '0') {\n            end = end.substring(1);\n          }\n\n          let startIndex = subTimes.indexOf(start);\n          let endIndex = subTimes.indexOf(end);\n\n          for (let j = startIndex; j < endIndex; j++) {\n            let nextEvent = document.getElementById(\"\".concat(date, \" \").concat(subTimes[j]));\n\n            if (nextEvent.className.includes(\"FriendBusy\")) {\n              if (nextEvent.className.includes(\"Sub\")) {\n                nextEvent.className = \"daySubHourOverlapBusy\";\n              } else {\n                nextEvent.className = \"dayHourOverlapBusy\";\n              }\n            } else {\n              nextEvent.className += \"Busy\";\n            }\n          }\n        }\n      }\n    };\n\n    this.setBusy2 = (events, userName) => {\n      for (let i = 0; i < events.length; i++) {\n        let date = events[i].start.dateTime.substring(8, 10);\n\n        if (date.substring(0, 1) === '0') {\n          date = date.substring(1);\n        }\n\n        let today = new Date().getDate();\n\n        if (date >= today) {\n          let start = events[i].start.dateTime.substring(11, 16);\n          let end = events[i].end.dateTime.substring(11, 16);\n\n          if (start.substring(0, 1) === '0') {\n            start = start.substring(1);\n          }\n\n          if (end.substring(0, 1) === '0') {\n            end = end.substring(1);\n          }\n\n          let startIndex = subTimes.indexOf(start);\n          let endIndex = subTimes.indexOf(end);\n\n          for (let j = startIndex; j < endIndex; j++) {\n            let nextEvent = document.getElementById(\"\".concat(date, \" \").concat(subTimes[j]));\n\n            if (nextEvent.className.includes(\"Busy\")) {\n              continue;\n            } else {\n              // if (j === startIndex) {\n              //   nextEvent.innerHTML = this.state.otherUser;\n              // }\n              nextEvent.className += \"FriendBusy\";\n            }\n          }\n        }\n      }\n    };\n\n    this.setFree = () => {\n      let x;\n\n      while (document.getElementsByClassName(\"dayHourBusy\").length > 0) {\n        x = document.getElementsByClassName(\"dayHourBusy\")[0];\n        x.className = \"dayHour\";\n        x.innerHTML = \"\";\n      }\n\n      let y;\n\n      while (document.getElementsByClassName(\"daySubHourBusy\").length > 0) {\n        y = document.getElementsByClassName(\"daySubHourBusy\")[0];\n        y.className = \"daySubHour\";\n        y.innerHTML = \"\";\n      }\n\n      let a;\n\n      while (document.getElementsByClassName(\"dayHourFriendBusy\").length > 0) {\n        a = document.getElementsByClassName(\"dayHourFriendBusy\")[0];\n        a.className = \"dayHour\";\n        a.innerHTML = \"\";\n      }\n\n      let b;\n\n      while (document.getElementsByClassName(\"daySubHourFriendBusy\").length > 0) {\n        b = document.getElementsByClassName(\"daySubHourFriendBusy\")[0];\n        b.className = \"daySubHour\";\n        b.innerHTML = \"\";\n      }\n\n      let c;\n\n      while (document.getElementsByClassName(\"daySubHourOverlapBusy\").length > 0) {\n        c = document.getElementsByClassName(\"daySubHourOverlapBusy\")[0];\n        c.className = \"dayHour\";\n        c.innerHTML = \"\";\n      }\n\n      let d;\n\n      while (document.getElementsByClassName(\"dayHourOverlapBusy\").length > 0) {\n        d = document.getElementsByClassName(\"dayHourOverlapBusy\")[0];\n        d.className = \"daySubHour\";\n        d.innerHTML = \"\";\n      }\n    };\n\n    this.Login = () => {\n      this.handleAuthClick();\n    };\n\n    this.Logout = () => {\n      this.handleSignoutClick();\n      this.setState({\n        uid: null,\n        userName: null\n      });\n    };\n\n    this.state = {\n      uid: null,\n      userName: null,\n      otherUser: null,\n      otherCalID: null\n    };\n    this.sign = false;\n    this.gapi = null;\n    this.onLoadCallback = null;\n    this.calendar = 'primary';\n\n    try {\n      this.updateSigninStatus = this.updateSigninStatus.bind(this);\n      this.initClient = this.initClient.bind(this);\n      this.handleSignoutClick = this.handleSignoutClick.bind(this);\n      this.handleAuthClick = this.handleAuthClick.bind(this);\n      this.createEvent = this.createEvent.bind(this);\n      this.listUpcomingEvents = this.listUpcomingEvents.bind(this);\n      this.createEventFromNow = this.createEventFromNow.bind(this);\n      this.listenSign = this.listenSign.bind(this);\n      this.onLoad = this.onLoad.bind(this);\n      this.setCalendar = this.setCalendar.bind(this);\n      this.handleClientLoad();\n      this.testcreateEvent = this.testcreateEvent.bind(this);\n    } catch (e) {\n      console.log(e);\n    }\n  }\n\n  updateSigninStatus(isSignedIn) {\n    this.sign = isSignedIn;\n\n    if (this.getUserID()) {\n      this.showEvents();\n    }\n  }\n  /**\n   * Auth to the google Api.\n   */\n\n\n  initClient() {\n    this.gapi = window['gapi'];\n    this.gapi.client.init(Config).then(() => {\n      // Listen for sign-in state changes.\n      this.gapi.auth2.getAuthInstance().isSignedIn.listen(this.updateSigninStatus); // Handle the initial sign-in state.\n\n      this.updateSigninStatus(this.gapi.auth2.getAuthInstance().isSignedIn.get());\n\n      if (this.onLoadCallback) {\n        this.onLoadCallback();\n      }\n    }).catch(e => {\n      console.log(e);\n    });\n  }\n  /**\n   * Init Google Api\n   * And create gapi in global\n   */\n\n\n  handleClientLoad() {\n    this.gapi = window['gapi'];\n    const script = document.createElement(\"script\");\n    script.src = \"https://apis.google.com/js/api.js\";\n    document.body.appendChild(script);\n\n    script.onload = () => {\n      window['gapi'].load('client:auth2', this.initClient);\n    };\n  }\n\n  getUserID() {\n    return this.gapi.auth2.getAuthInstance().currentUser['Ab']['El'];\n  }\n\n  getUserName() {\n    return this.gapi.auth2.getAuthInstance().currentUser['Ab']['w3']['ig'];\n  }\n\n  getEmail() {\n    return this.gapi.auth2.getAuthInstance().currentUser.Ab.w3.U3;\n  }\n  /**\n   * Sign in Google user account\n   */\n\n\n  handleAuthClick() {\n    if (this.gapi) {\n      this.gapi.auth2.getAuthInstance().signIn();\n    } else {\n      console.log(\"Error: this.gapi not loaded\");\n    }\n  }\n  /**\n   * Set the default attribute calendar\n   * @param {string} newCalendar\n   */\n\n\n  setCalendar(newCalendar) {\n    this.calendar = newCalendar;\n  }\n  /**\n   * Execute the callback function when a user is disconnected or connected with the sign status.\n   * @param callback\n   */\n\n\n  listenSign(callback) {\n    if (this.gapi) {\n      this.gapi.auth2.getAuthInstance().isSignedIn.listen(callback);\n    } else {\n      console.log(\"Error: this.gapi not loaded\");\n    }\n  }\n  /**\n   * Execute the callback function when gapi is loaded\n   * @param callback\n   */\n\n\n  onLoad(callback) {\n    if (this.gapi) {\n      callback();\n    } else {\n      this.onLoadCallback = callback;\n    }\n  }\n  /**\n   * Sign out user google account\n   */\n\n\n  handleSignoutClick() {\n    if (this.gapi) {\n      this.gapi.auth2.getAuthInstance().signOut();\n      this.setFree();\n      const userLink = window.location.pathname.substring(1);\n\n      if (userLink) {\n        db.child(userLink).child(\"events\").once('value', this.handleData, error => alert(error));\n      }\n    } else {\n      console.log(\"Error: this.gapi not loaded\");\n    }\n  }\n  /**\n   * List all events in the calendar\n   * @param {number} maxResults to see\n   * @param {string} calendarId to see by default use the calendar attribute\n   * @returns {any}\n   */\n\n\n  listUpcomingEvents(calendarId = this.calendar) {\n    if (this.gapi) {\n      let d = new Date();\n      d.setDate(d.getDate() + 7);\n      return this.gapi.client.calendar.events.list({\n        'calendarId': calendarId,\n        'timeMin': new Date().toISOString(),\n        'timeMax': d.toISOString(),\n        'showDeleted': false,\n        'singleEvents': true,\n        'orderBy': 'startTime'\n      });\n    } else {\n      console.log(\"Error: this.gapi not loaded\");\n      return false;\n    }\n  }\n  /**\n   * Create an event from the current time for a certain period\n   * @param {number} time in minutes for the event\n   * @param {string} summary of the event\n   * @param {string} description of the event\n   * @param {string} calendarId\n   * @returns {any}\n   */\n\n\n  createEventFromNow({\n    time,\n    summary,\n    description = ''\n  }, calendarId = this.calendar) {\n    const event = {\n      summary,\n      description,\n      start: {\n        dateTime: new Date().toISOString(),\n        timeZone: \"Europe/Paris\"\n      },\n      end: {\n        dateTime: new Date(new Date().getTime() + time * 60000),\n        timeZone: \"Europe/Paris\"\n      }\n    };\n    return this.gapi.client.calendar.events.insert({\n      'calendarId': calendarId,\n      'resource': event\n    });\n  }\n  /**\n   * Create Calendar event\n   * @param {string} calendarId for the event.\n   * @param {object} event with start and end dateTime\n   * @returns {any}\n   */\n\n\n  createEvent(event, calendarId = this.calendar) {\n    return this.gapi.client.calendar.events.insert({\n      'calendarId': calendarId,\n      'resource': event\n    });\n  }\n\n  testcreateEvent(event, starttime, endtime) {\n    var attendees = this.state.otherCalID ? [{\n      \"email\": this.state.otherCalID\n    }] : [];\n    var uploadevent = {\n      'summary': event,\n      'description': '',\n      'start': {\n        'dateTime': starttime,\n        'timeZone': 'America/Chicago'\n      },\n      'end': {\n        'dateTime': endtime,\n        'timeZone': 'America/Chicago'\n      },\n      'attendees': attendees\n    };\n    var request = this.gapi.client.calendar.events.insert({\n      'calendarId': this.calendar,\n      'resource': uploadevent\n    });\n    request.execute();\n    window.location.reload();\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 586\n      },\n      __self: this\n    }, this.state.uid ? React.createElement(\"button\", {\n      onClick: () => this.Logout(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 587\n      },\n      __self: this\n    }, \"Sign out\") : null, this.state.uid ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 589\n      },\n      __self: this\n    }, \"Welcome, \", this.state.userName, \"!\") : React.createElement(\"button\", {\n      onClick: () => {\n        this.Login();\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 589\n      },\n      __self: this\n    }, \"Sync with Google\"), this.state.userName && !this.state.otherUser ? React.createElement(LinkGenerator, {\n      link: this.setLink(this.state.uid),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 590\n      },\n      __self: this\n    }) : null, React.createElement(Addevents, {\n      createEvent: this.testcreateEvent,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 591\n      },\n      __self: this\n    }), this.Main());\n  }\n\n}\nApiCalendar.propTypes = {\n  uid: null,\n  name: null\n};\nlet apiCalendar;\n\ntry {\n  apiCalendar = new ApiCalendar();\n} catch (e) {\n  console.log(e);\n}","map":{"version":3,"sources":["/Users/boyuwang/Documents/GitHub/travis/ez-cal/src/ApiCalendar.js"],"names":["db","subTimes","times","React","Component","LinkGenerator","Switch","Route","Addevents","Config","require","ApiCalendar","constructor","props","componentDidMount","userLink","window","location","pathname","substring","child","once","printUserName","error","alert","setOtherID","handleData","snap","val","setState","otherUser","otherCalID","state","setBusy2","Object","values","checkLastDay","month","year","numberOfDays","isLeapYear","buildDayList","date","Date","getMonth","getFullYear","weekDays","dayList","dateList","i","push","getDay","getDate","dayGrid","days","dates","realTimes","slice","length","timeBlock","map","x","split","cal","hours","j","display","includes","SharedCalendar","MyCalendar","Main","setLink","uid","href","showEvents","googleEvents","sign","listUpcomingEvents","then","result","items","getUserID","userName","getUserName","set","getEmail","setBusy","events","start","dateTime","end","startIndex","indexOf","endIndex","nextEvent","document","getElementById","className","today","setFree","getElementsByClassName","innerHTML","y","a","b","c","d","Login","handleAuthClick","Logout","handleSignoutClick","gapi","onLoadCallback","calendar","updateSigninStatus","bind","initClient","createEvent","createEventFromNow","listenSign","onLoad","setCalendar","handleClientLoad","testcreateEvent","e","console","log","isSignedIn","client","init","auth2","getAuthInstance","listen","get","catch","script","createElement","src","body","appendChild","onload","load","currentUser","Ab","w3","U3","signIn","newCalendar","callback","signOut","calendarId","setDate","list","toISOString","time","summary","description","event","timeZone","getTime","insert","starttime","endtime","attendees","uploadevent","request","execute","reload","render","propTypes","name","apiCalendar"],"mappings":"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","sourcesContent":["import { db } from './firebase';\nimport { subTimes, times } from './constants';\nimport React, { Component } from 'react';\nimport LinkGenerator from \"./LinkGenerator\";\nimport { Switch, Route } from 'react-router-dom'\nimport Addevents from \"./newaddevent\";\nconst Config = require(\"./data/apiGoogleconfig.json\");\n\nexport default class ApiCalendar extends Component {\n\n  static propTypes = {\n    uid: null,\n    name: null\n  }\n  constructor(props) {\n    super(props);\n    this.state = {\n      uid: null,\n      userName: null,\n      otherUser: null,\n      otherCalID: null\n    }\n    this.sign = false;\n    this.gapi = null;\n    this.onLoadCallback = null;\n    this.calendar = 'primary';\n    try {\n      this.updateSigninStatus = this.updateSigninStatus.bind(this);\n      this.initClient = this.initClient.bind(this);\n      this.handleSignoutClick = this.handleSignoutClick.bind(this);\n      this.handleAuthClick = this.handleAuthClick.bind(this);\n      this.createEvent = this.createEvent.bind(this);\n      this.listUpcomingEvents = this.listUpcomingEvents.bind(this);\n      this.createEventFromNow = this.createEventFromNow.bind(this);\n      this.listenSign = this.listenSign.bind(this);\n      this.onLoad = this.onLoad.bind(this);\n      this.setCalendar = this.setCalendar.bind(this);\n      this.handleClientLoad();\n      this.testcreateEvent = this.testcreateEvent.bind(this);\n    }\n    catch (e) {\n      console.log(e);\n    }\n  }\n\n  componentDidMount = () => {\n    const userLink = window.location.pathname.substring(1);\n    if (userLink) {\n      db.child(userLink).child(\"userName\").once('value', this.printUserName, error => alert(error));\n      db.child(userLink).child(\"calID\").once('value', this.setOtherID, error => alert(error));\n      db.child(userLink).child(\"events\").once('value', this.handleData, error => alert(error));\n    }\n  };\n\n  printUserName = (snap) => {\n    if (snap.val()) {\n      this.setState({\n        otherUser: snap.val(),\n      })\n    }\n  }\n\n  setOtherID = (snap) => {\n    if (snap.val()) {\n      this.setState({\n        otherCalID: snap.val()\n      })\n    }\n  }\n\n  handleData = (snap) => {\n    if (snap.val()) {\n      if (this.state.otherUser) {\n        this.setBusy2(Object.values(snap.val(), this.state.otherUser));\n      }\n    }\n  };\n\n  checkLastDay = (month, year) => {\n    var numberOfDays;\n    if (month == 4 || month == 6 || month == 9 || month == 11)\n      numberOfDays = 30;\n    else if (month == 2) {\n      const isLeapYear = (year) => (year % 4 == 0 && year % 100 != 0) || (year % 400 == 0);\n      if (isLeapYear(year))\n        numberOfDays = 29;\n      else\n        numberOfDays = 28;\n    }\n    else\n      numberOfDays = 31;\n\n    return numberOfDays;\n  }\n\n  buildDayList = () => {\n    let date = new Date();\n    let numberOfDays = this.checkLastDay(date.getMonth() + 1, date.getFullYear());\n    let weekDays = [\"Su\", \"M\", \"Tu\", \"W\", \"Th\", \"F\", \"Sa\"];\n    let dayList = [], dateList = [];\n\n    for (let i = 0; i < 7; i++) {\n      dayList.push(weekDays[(date.getDay() + i) % 7]);\n      if ((date.getDate() + i) > numberOfDays) {\n        dateList.push((date.getDate() + i) % (numberOfDays));\n      }\n      else {\n        dateList.push(date.getDate() + i);\n      }\n    }\n    return [dayList, dateList];\n  };\n\n  dayGrid = () => {\n    let [days, dates] = this.buildDayList();\n    let realTimes = subTimes.slice(0, subTimes.length - 1)\n    let timeBlock = realTimes.map(x => {\n      return x.split(\":\")[1] === \"00\" ? <div className=\"dayTime\">{x}</div> : <div className=\"dayTime\"></div>;\n    });\n\n    let cal = [];\n    cal.push(<div className=\"dayCol\">\n      <div className=\"dayEmpty\"></div>\n      {timeBlock}\n    </div>\n    );\n\n    for (let i = 0; i < days.length; i++) {\n      let hours = [];\n      for (let j = 0; j < subTimes.length; j++) {\n        if (subTimes[j] === \"0:00\") {\n          hours.push(<div id={`${dates[i]} ${subTimes[j]}`} styles={{ display: \"hidden\" }} />);\n        }\n        else if (times.includes(subTimes[j])) {\n          hours.push(<div id={`${dates[i]} ${subTimes[j]}`} className=\"dayHour\" />);\n        }\n        else {\n          hours.push(<div id={`${dates[i]} ${subTimes[j]}`} className=\"daySubHour\" />);\n        }\n      }\n\n      cal.push(<div className=\"dayCol\">\n        <div className=\"dayHead\">{days[i]}\n          <div className=\"dayDate\">{dates[i]}</div>\n        </div>\n        {hours}\n      </div>);\n    }\n\n\n    return (\n      <div className=\"dayWrapper\">\n        {cal}\n      </div>\n    );\n  };\n\n  SharedCalendar = () => {\n    return (\n      <div>\n        {this.dayGrid()}\n      </div>\n    );\n  };\n\n  MyCalendar = () => {\n    return (\n      <div>\n        {this.dayGrid()}\n      </div>\n    );\n  };\n\n  Main = () => {\n    return (\n      <Switch>\n        <Route exact path='/' component={this.MyCalendar} />\n        <Route path={window.location.pathname} component={this.SharedCalendar} />\n      </Switch>\n    );\n  };\n\n  /**\n   * Update connection status.\n   * @param {boolean} isSignedIn\n   */\n\n  setLink = (uid) => {\n    return window.location.href + uid;\n  };\n\n  showEvents = () => {\n    let googleEvents;\n    if (this.sign)\n      this.listUpcomingEvents()\n        .then(({ result }) => {\n          googleEvents = result.items;\n          this.setState({\n            uid: this.getUserID(),\n            userName: this.getUserName(),\n          })\n\n          db.child(this.getUserID()).child('events').set(googleEvents);\n          db.child(this.getUserID()).child('userName').set(this.getUserName());\n          db.child(this.getUserID()).child('calID').set(this.getEmail());\n\n          this.setBusy(googleEvents);\n        });\n  };\n\n  setBusy = (events) => {\n    const userLink = window.location.pathname.substring(1);\n    if (!userLink) {\n      for (let i = 0; i < events.length; i++) {\n\n        if (!events[i].start.dateTime) {\n          continue;\n        }\n        let date = events[i].start.dateTime.substring(8, 10);\n\n        if (date.substring(0, 1) === '0') {\n          date = date.substring(1);\n        }\n\n        let start = events[i].start.dateTime.substring(11, 16);\n        let end = events[i].end.dateTime.substring(11, 16);\n\n        if (start.substring(0, 1) === '0') {\n          start = start.substring(1);\n        }\n\n        if (end.substring(0, 1) === '0') {\n          end = end.substring(1);\n        }\n\n        let startIndex = subTimes.indexOf(start);\n        let endIndex = subTimes.indexOf(end);\n\n        for (let j = startIndex; j < endIndex; j++) {\n          let nextEvent = document.getElementById(`${date} ${subTimes[j]}`);\n          if (nextEvent.className.includes(\"Busy\")) {\n            continue;\n          }\n          else {\n            nextEvent.className += \"Busy\";\n          }\n        }\n      }\n    }\n    else if (userLink && this.state.uid) {\n      for (let i = 0; i < events.length; i++) {\n        if (!events[i].start.dateTime) {\n          continue;\n        }\n        let date = events[i].start.dateTime.substring(8, 10);\n        if (date.substring(0, 1) === '0') {\n          date = date.substring(1);\n        }\n        let start = events[i].start.dateTime.substring(11, 16);\n        let end = events[i].end.dateTime.substring(11, 16);\n\n        if (start.substring(0, 1) === '0') {\n          start = start.substring(1);\n        }\n        if (end.substring(0, 1) === '0') {\n          end = end.substring(1);\n        }\n\n        let startIndex = subTimes.indexOf(start);\n        let endIndex = subTimes.indexOf(end);\n\n        for (let j = startIndex; j < endIndex; j++) {\n          let nextEvent = document.getElementById(`${date} ${subTimes[j]}`);\n          if (nextEvent.className.includes(\"FriendBusy\")) {\n            if (nextEvent.className.includes(\"Sub\")) {\n              nextEvent.className = \"daySubHourOverlapBusy\"\n            }\n            else {\n              nextEvent.className = \"dayHourOverlapBusy\"\n            }\n          }\n          else {\n            nextEvent.className += \"Busy\";\n          }\n        }\n      }\n    }\n  };\n\n  setBusy2 = (events, userName) => {\n    for (let i = 0; i < events.length; i++) {\n      let date = events[i].start.dateTime.substring(8, 10);\n      if (date.substring(0, 1) === '0') {\n        date = date.substring(1);\n      }\n\n      let today = new Date().getDate();\n      if (date >= today) {\n        let start = events[i].start.dateTime.substring(11, 16);\n        let end = events[i].end.dateTime.substring(11, 16);\n\n        if (start.substring(0, 1) === '0') {\n          start = start.substring(1);\n        }\n        if (end.substring(0, 1) === '0') {\n          end = end.substring(1);\n        }\n\n        let startIndex = subTimes.indexOf(start);\n        let endIndex = subTimes.indexOf(end);\n\n        for (let j = startIndex; j < endIndex; j++) {\n          let nextEvent = document.getElementById(`${date} ${subTimes[j]}`);\n          if (nextEvent.className.includes(\"Busy\")) {\n            continue;\n          }\n          else {\n            // if (j === startIndex) {\n            //   nextEvent.innerHTML = this.state.otherUser;\n            // }\n            nextEvent.className += \"FriendBusy\";\n          }\n        }\n      }\n    }\n  }\n\n  setFree = () => {\n    let x;\n    while (document.getElementsByClassName(\"dayHourBusy\").length > 0) {\n      x = document.getElementsByClassName(\"dayHourBusy\")[0]\n      x.className = \"dayHour\"\n      x.innerHTML = \"\"\n    }\n    let y;\n    while (document.getElementsByClassName(\"daySubHourBusy\").length > 0) {\n      y = document.getElementsByClassName(\"daySubHourBusy\")[0]\n      y.className = \"daySubHour\"\n      y.innerHTML = \"\"\n    }\n    let a;\n    while (document.getElementsByClassName(\"dayHourFriendBusy\").length > 0) {\n      a = document.getElementsByClassName(\"dayHourFriendBusy\")[0]\n      a.className = \"dayHour\"\n      a.innerHTML = \"\"\n    }\n    let b;\n    while (document.getElementsByClassName(\"daySubHourFriendBusy\").length > 0) {\n      b = document.getElementsByClassName(\"daySubHourFriendBusy\")[0]\n      b.className = \"daySubHour\"\n      b.innerHTML = \"\"\n    }\n    let c;\n    while (document.getElementsByClassName(\"daySubHourOverlapBusy\").length > 0) {\n      c = document.getElementsByClassName(\"daySubHourOverlapBusy\")[0]\n      c.className = \"dayHour\"\n      c.innerHTML = \"\"\n    }\n    let d;\n    while (document.getElementsByClassName(\"dayHourOverlapBusy\").length > 0) {\n      d = document.getElementsByClassName(\"dayHourOverlapBusy\")[0]\n      d.className = \"daySubHour\"\n      d.innerHTML = \"\"\n    }\n\n  };\n\n\n  updateSigninStatus(isSignedIn) {\n    this.sign = isSignedIn;\n    if (this.getUserID()) {\n      this.showEvents();\n    }\n\n  }\n  /**\n   * Auth to the google Api.\n   */\n  initClient() {\n    this.gapi = window['gapi'];\n    this.gapi.client.init(Config)\n      .then(() => {\n        // Listen for sign-in state changes.\n        this.gapi.auth2.getAuthInstance().isSignedIn.listen(this.updateSigninStatus);\n        // Handle the initial sign-in state.\n        this.updateSigninStatus(this.gapi.auth2.getAuthInstance().isSignedIn.get());\n        if (this.onLoadCallback) {\n          this.onLoadCallback();\n        }\n      })\n      .catch((e) => {\n        console.log(e);\n      });\n  }\n  /**\n   * Init Google Api\n   * And create gapi in global\n   */\n  handleClientLoad() {\n    this.gapi = window['gapi'];\n    const script = document.createElement(\"script\");\n    script.src = \"https://apis.google.com/js/api.js\";\n    document.body.appendChild(script);\n    script.onload = () => {\n      window['gapi'].load('client:auth2', this.initClient);\n    };\n  }\n  getUserID() {\n    return this.gapi.auth2.getAuthInstance().currentUser['Ab']['El'];\n  }\n\n  getUserName() {\n    return this.gapi.auth2.getAuthInstance().currentUser['Ab']['w3']['ig'];\n  }\n\n  getEmail() {\n    return this.gapi.auth2.getAuthInstance().currentUser.Ab.w3.U3;\n  }\n\n  /**\n   * Sign in Google user account\n   */\n  handleAuthClick() {\n    if (this.gapi) {\n      this.gapi.auth2.getAuthInstance().signIn();\n    }\n    else {\n      console.log(\"Error: this.gapi not loaded\");\n    }\n  }\n  /**\n   * Set the default attribute calendar\n   * @param {string} newCalendar\n   */\n  setCalendar(newCalendar) {\n    this.calendar = newCalendar;\n  }\n  /**\n   * Execute the callback function when a user is disconnected or connected with the sign status.\n   * @param callback\n   */\n  listenSign(callback) {\n    if (this.gapi) {\n      this.gapi.auth2.getAuthInstance().isSignedIn.listen(callback);\n    }\n    else {\n      console.log(\"Error: this.gapi not loaded\");\n    }\n  }\n  /**\n   * Execute the callback function when gapi is loaded\n   * @param callback\n   */\n  onLoad(callback) {\n    if (this.gapi) {\n      callback();\n    }\n    else {\n      this.onLoadCallback = callback;\n    }\n  }\n  /**\n   * Sign out user google account\n   */\n  handleSignoutClick() {\n    if (this.gapi) {\n      this.gapi.auth2.getAuthInstance().signOut();\n      this.setFree();\n      const userLink = window.location.pathname.substring(1);\n      if (userLink) {\n        db.child(userLink).child(\"events\").once('value', this.handleData, error => alert(error));\n      }\n    }\n    else {\n      console.log(\"Error: this.gapi not loaded\");\n    }\n  }\n  /**\n   * List all events in the calendar\n   * @param {number} maxResults to see\n   * @param {string} calendarId to see by default use the calendar attribute\n   * @returns {any}\n   */\n  listUpcomingEvents(calendarId = this.calendar) {\n    if (this.gapi) {\n      let d = new Date();\n      d.setDate(d.getDate() + 7);\n      return this.gapi.client.calendar.events.list({\n        'calendarId': calendarId,\n        'timeMin': (new Date()).toISOString(),\n        'timeMax': d.toISOString(),\n        'showDeleted': false,\n        'singleEvents': true,\n        'orderBy': 'startTime'\n      });\n    }\n    else {\n      console.log(\"Error: this.gapi not loaded\");\n      return false;\n    }\n  }\n  /**\n   * Create an event from the current time for a certain period\n   * @param {number} time in minutes for the event\n   * @param {string} summary of the event\n   * @param {string} description of the event\n   * @param {string} calendarId\n   * @returns {any}\n   */\n  createEventFromNow({ time, summary, description = '' }, calendarId = this.calendar) {\n    const event = {\n      summary,\n      description,\n      start: {\n        dateTime: (new Date()).toISOString(),\n        timeZone: \"Europe/Paris\",\n      },\n      end: {\n        dateTime: (new Date(new Date().getTime() + time * 60000)),\n        timeZone: \"Europe/Paris\",\n      }\n    };\n    return this.gapi.client.calendar.events.insert({\n      'calendarId': calendarId,\n      'resource': event,\n    });\n  }\n  /**\n   * Create Calendar event\n   * @param {string} calendarId for the event.\n   * @param {object} event with start and end dateTime\n   * @returns {any}\n   */\n  createEvent(event, calendarId = this.calendar) {\n\n    return this.gapi.client.calendar.events.insert({\n      'calendarId': calendarId,\n      'resource': event,\n    });\n  }\n\n  testcreateEvent(event, starttime, endtime) {\n\n    var attendees = this.state.otherCalID ? [{ \"email\": this.state.otherCalID }] : [];\n\n    var uploadevent = {\n      'summary': event,\n      'description': '',\n      'start': {\n        'dateTime': starttime,\n        'timeZone': 'America/Chicago'\n      },\n      'end': {\n        'dateTime': endtime,\n        'timeZone': 'America/Chicago'\n      },\n      'attendees': attendees\n    };\n\n    var request = this.gapi.client.calendar.events.insert({\n      'calendarId': this.calendar,\n      'resource': uploadevent\n    });\n\n    request.execute();\n\n    window.location.reload();\n  }\n\n\n  Login = () => {\n    this.handleAuthClick();\n  }\n\n  Logout = () => {\n    this.handleSignoutClick();\n    this.setState({\n      uid: null,\n      userName: null,\n    })\n  }\n\n  render() {\n\n    return (\n      <div>\n        {this.state.uid ? <button onClick={() => this.Logout()}>Sign out</button> : null}\n\n        {this.state.uid ? <div>Welcome, {this.state.userName}!</div> : <button onClick={() => { this.Login() }}>Sync with Google</button>}\n        {(this.state.userName && !this.state.otherUser) ? <LinkGenerator link={this.setLink(this.state.uid)} /> : null}\n        <Addevents createEvent={this.testcreateEvent} />\n        {this.Main()}\n      </div>\n    )\n  }\n}\nlet apiCalendar;\ntry {\n  apiCalendar = new ApiCalendar();\n}\ncatch (e) {\n  console.log(e);\n}\n\n\n"]},"metadata":{},"sourceType":"module"}